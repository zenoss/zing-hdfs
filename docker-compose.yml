version: "3.3"
services:
  hdfs-namenode:
    build: 
      context: .
      labels:
        zenoss.zing.commit-sha: ${COMMIT_SHA:-none}
        zenoss.zing.pull-request: ${PULL_REQUEST:-none}
        zenoss.zing.branch_name: ${GIT_BRANCH:-none}
        zenoss.zing.build_number: ${BUILD_ID:-none}
        zenoss.zing.build_url: ${BUILD_URL:-none}
    image: ${SERVICE_IMAGE}:${IMAGE_TAG:-dev}
    command: namenode
    environment:
      CLUSTER_NAME: hdfs-namenode
      CONFIG_TYPE: dev
    healthcheck:
      test: test $$(curl -sA healthcheck -o /dev/null -w "%{http_code}" localhost:50070) = 200
    ports:
    - 50070:50070 # NameNode WebUI
    volumes:
    - hdfs_nn:/data/hdfs/nn:rw
  hdfs-datanode:
    image: ${SERVICE_IMAGE}:${IMAGE_TAG:-dev}
    command: datanode
    healthcheck:
      test: test $$(curl -sA healthcheck -o /dev/null -w "%{http_code}" localhost:50075) = 200
    environment:
      CLUSTER_NAME: hdfs-namenode
      CONFIG_TYPE: dev
      BOOTSTRAP_SLEEP: 10
    volumes:
    - hdfs_dn:/data/hdfs/dn:rw
volumes:
  hdfs_dn: {}
  hdfs_nn: {}
